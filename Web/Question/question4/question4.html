<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 포털</title>
    <style>
        body {
            background-color: #0a0a0a;
            color: #33ff33;
            font-family: 'Courier New', monospace;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .terminal {
            background-color: #1a1a1a;
            padding: 20px;
            border: 1px solid #33ff33;
            margin: 20px 0;
        }
        input, button {
            background-color: #1a1a1a;
            color: #33ff33;
            border: 1px solid #33ff33;
            padding: 5px 10px;
            margin: 5px;
        }
        .hidden {
            display: none;
        }
        #error-msg {
            color: #ff3333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="terminal">
            <h2>시스템 접근 제어</h2>
            <div id="login-section">
                <input type="text" id="username" placeholder="사용자명">
                <input type="password" id="password" placeholder="비밀번호">
                <button onclick="login()">로그인</button>
                <p id="error-msg"></p>
            </div>
            <div id="admin-panel" class="hidden">
                <h3>관리자 패널</h3>
                <div id="secret-content"></div>
            </div>
        </div>
    </div>

    <script>
        // AES 암호화 함수 (CryptoJS 라이브러리 필요)
        document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"><\/script>');

        // 난독화된 API 엔드포인트
        const _0x2a8f=['aHR0cHM6Ly9hcGkuZXhhbXBsZS5jb20vYXBpL3YxL2F1dGg='];
        const API_ENDPOINT = atob(_0x2a8f[0]);

        // JWT 토큰 생성 함수
        function generateToken(payload) {
            const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));
            const encodedPayload = btoa(JSON.stringify(payload));
            const signature = CryptoJS.HmacSHA256(header + '.' + encodedPayload, 'secret_key').toString();
            return `${header}.${encodedPayload}.${signature}`;
        }

        // 로그인 처리
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                // 사용자 검증 (실제로는 서버에서 처리해야 함)
                if (username === 'guest' && password === 'guest123') {
                    const token = generateToken({
                        username: username,
                        role: 'guest',
                        exp: Date.now() + 3600000
                    });

                    localStorage.setItem('auth_token', token);
                    checkAccess();
                } else {
                    document.getElementById('error-msg').textContent = '잘못된 인증정보입니다.';
                }
            } catch (error) {
                console.error('로그인 오류:', error);
            }
        }

        // 접근 권한 확인
        function checkAccess() {
            const token = localStorage.getItem('auth_token');
            if (!token) return;

            try {
                const [header, payload, signature] = token.split('.');
                const decodedPayload = JSON.parse(atob(payload));

                if (decodedPayload.role === 'admin') {
                    document.getElementById('login-section').classList.add('hidden');
                    document.getElementById('admin-panel').classList.remove('hidden');
                    loadSecretContent();
                } else {
                    document.getElementById('error-msg').textContent = '관리자 권한이 필요합니다.';
                }
            } catch (error) {
                console.error('토큰 검증 오류:', error);
            }
        }

        // 비밀 컨텐츠 로드
        function loadSecretContent() {
            const encryptedFlag = 'U2FsdGVkX19KV1QjhX7/8q9WQj+zX5tX/YwF+A8L1Jw=';
            const key = CryptoJS.SHA256('admin_key_2024');
            
            try {
                const decryptedFlag = CryptoJS.AES.decrypt(encryptedFlag, key).toString(CryptoJS.enc.Utf8);
                document.getElementById('secret-content').textContent = `축하합니다! 플래그를 찾았습니다: ${decryptedFlag}`;
            } catch (error) {
                console.error('복호화 오류:', error);
            }
        }

        // 초기 상태 확인
        window.onload = function() {
            checkAccess();
            // 개발자 콘솔에 힌트 출력
            console.log('힌트1: JWT 토큰의 구조를 분석하세요.');
            console.log('힌트2: localStorage를 확인해보세요.');
            setTimeout(() => {
                console.log('힌트3: admin 권한이 필요합니다. JWT는 조작 가능할까요?');
            }, 10000);
        }

        // 추가된 보안 검사
        setInterval(() => {
            const token = localStorage.getItem('auth_token');
            if (token) {
                try {
                    const [header, payload, signature] = token.split('.');
                    const decodedPayload = JSON.parse(atob(payload));
                    if (decodedPayload.exp < Date.now()) {
                        localStorage.removeItem('auth_token');
                        location.reload();
                    }
                } catch (error) {
                    console.error('토큰 검증 오류:', error);
                }
            }
        }, 5000);
    </script>
</body>
</html>
